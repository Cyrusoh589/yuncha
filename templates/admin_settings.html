{% extends 'base.html' %}
{% block body %}
  <div class="nav" style="margin-bottom:14px">
    <a class="pill" href="/admin">대시보드</a>
    <a class="pill" href="/admin/inbox">승인함</a>
    <a class="pill" href="/admin/employees">직원</a>
    <a class="pill active" href="/admin/settings">설정</a>
  </div>

  <div class="grid cols-3">
    <div class="card" style="grid-column:span 2">
      <div style="font-weight:900;font-size:18px">정책/설정</div>
      <div class="sub">1일=8시간(480분), 병가 기본 10일, 관리자 PIN 변경 가능</div>

      <div class="split" style="margin-top:10px">
        <div class="field">
          <label>1일 기준(분) workday_minutes</label>
          <input id="workday" type="number" min="60" step="30"/>
        </div>
        <div class="field">
          <label>병가 기본일수 sick_default_days</label>
          <input id="sick" type="number" min="0" step="1"/>
        </div>
      </div>
      <div class="field">
        <label>관리자 PIN admin_pin</label>
        <input id="pin"/>
      </div>

      <div class="row" style="justify-content:flex-end">
        <button class="btn primary" onclick="save()">저장</button>
      </div>
    </div>

    <div class="card">
      <h3>휴가 유형(기본 탑재)</h3>
      <div class="sub">연차/병가/경조/공가. 추후 추가 가능.</div>
      <div id="types" style="margin-top:10px"></div>
    </div>
  </div>

<script>
  async function load(){
    const p = await (await fetch('/api/admin/policies')).json();
    document.getElementById('workday').value = p.workday_minutes;
    document.getElementById('sick').value = p.sick_default_days;
    document.getElementById('pin').value = p.admin_pin;

    const types = await (await fetch('/api/leave_types')).json();
    document.getElementById('types').innerHTML = types.map(t=>`<div class="badge" style="margin:6px 0"><span class="dot" style="background:${t.color_hex}"></span>${t.name_ko} <span class="sub" style="margin-left:6px">(${t.default_unit})</span></div>`).join('');
  }

  async function save(){
    const payload={
      workday_minutes: document.getElementById('workday').value,
      sick_default_days: document.getElementById('sick').value,
      admin_pin: document.getElementById('pin').value,
    };
    const res = await fetch('/api/admin/policies', {method:'PUT', headers:{'Content-Type':'application/json'}, body: JSON.stringify(payload)});
    const j = await res.json();
    if(!j.success){ alert('저장 실패'); return; }
    alert('저장 완료');
  }

  load();
</script>
{% endblock %}
